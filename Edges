#include <iostream>
#include <cmath>
#include "libs/Image_Class.h"
using namespace std;

void edgeDetection(Image& image) {
    Image temp = image; 

    for (int y = 0; y < image.height - 1; y++) {
        for (int x = 0; x < image.width - 1; x++) {
            
            unsigned char r1 = temp(x, y, 0);
            unsigned char g1 = temp(x, y, 1);
            unsigned char b1 = temp(x, y, 2);
            
            unsigned char r2 = temp(x + 1, y, 0);
            unsigned char g2 = temp(x + 1, y, 1);
            unsigned char b2 = temp(x + 1, y, 2);
            
            unsigned char r3 = temp(x, y + 1, 0);
            unsigned char g3 = temp(x, y + 1, 1);
            unsigned char b3 = temp(x, y + 1, 2);
            
            int diff1 = abs(r1 - r2) + abs(g1 - g2) + abs(b1 - b2);
            int diff2 = abs(r1 - r3) + abs(g1 - g3) + abs(b1 - b3);

            int edgeValue = (diff1 + diff2) / 2;
            
            if (edgeValue > 50)
                edgeValue = 0;
            else
                edgeValue = 255;
            
            image(x, y, 0) = edgeValue;
            image(x, y, 1) = edgeValue;
            image(x, y, 2) = edgeValue;
        }
    }
}

int main() {
    string inputName, outputName;

    cout << "Enter input image name (e.g. photo.jpg): ";
    cin >> inputName;

    cout << "Enter output image name (e.g. edges.jpg): ";
    cin >> outputName;
    
    Image img(inputName);
    
    edgeDetection(img);
    
    img.saveImage(outputName);
    return 0;
}
